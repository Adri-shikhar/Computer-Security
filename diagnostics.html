<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>System Diagnostics - What's Happening</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #0f0c29, #302b63, #24243e);
            color: white;
            padding: 20px;
            min-height: 100vh;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        h1 {
            text-align: center;
            color: #00f3ff;
            margin-bottom: 10px;
            font-size: 2.5em;
            text-shadow: 0 0 30px rgba(0, 243, 255, 0.8);
        }
        .subtitle {
            text-align: center;
            color: #aaa;
            margin-bottom: 40px;
            font-size: 1.2em;
        }
        .status-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        .status-card {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 25px;
            transition: all 0.3s;
        }
        .status-card:hover {
            transform: translateY(-5px);
            border-color: #00f3ff;
            box-shadow: 0 10px 30px rgba(0, 243, 255, 0.3);
        }
        .status-card h2 {
            font-size: 1.3em;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .status-icon {
            font-size: 1.5em;
        }
        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-left: auto;
            animation: pulse 2s infinite;
        }
        .status-indicator.online { background: #00ff88; }
        .status-indicator.offline { background: #ff4757; }
        .status-indicator.checking { background: #ffa502; }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        .detail {
            font-size: 0.9em;
            color: #aaa;
            margin: 8px 0;
            padding: 8px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 5px;
        }
        .detail strong {
            color: #00f3ff;
        }
        .section {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
        }
        .section h2 {
            color: #00f3ff;
            margin-bottom: 20px;
            font-size: 1.8em;
        }
        .explanation {
            background: rgba(0, 243, 255, 0.1);
            border-left: 4px solid #00f3ff;
            padding: 20px;
            border-radius: 8px;
            margin: 15px 0;
        }
        .explanation h3 {
            color: #00f3ff;
            margin-bottom: 10px;
        }
        .code-block {
            background: rgba(0, 0, 0, 0.4);
            padding: 15px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
            overflow-x: auto;
            margin: 10px 0;
        }
        .feature-list {
            list-style: none;
            padding: 0;
        }
        .feature-list li {
            padding: 12px;
            margin: 8px 0;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 8px;
            border-left: 3px solid #00f3ff;
            transition: all 0.2s;
        }
        .feature-list li:hover {
            background: rgba(0, 243, 255, 0.1);
            transform: translateX(5px);
        }
        .action-buttons {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            margin-top: 20px;
        }
        .action-buttons button {
            flex: 1;
            min-width: 200px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 25px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 1em;
            font-weight: 600;
            transition: all 0.3s;
        }
        .action-buttons button:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.5);
        }
        .timeline {
            position: relative;
            padding-left: 30px;
        }
        .timeline::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 2px;
            background: linear-gradient(to bottom, #00f3ff, #667eea);
        }
        .timeline-item {
            position: relative;
            margin-bottom: 20px;
            padding-left: 20px;
        }
        .timeline-item::before {
            content: '';
            position: absolute;
            left: -36px;
            top: 5px;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #00f3ff;
            box-shadow: 0 0 10px #00f3ff;
        }
        .success { color: #00ff88; }
        .error { color: #ff4757; }
        .warning { color: #ffa502; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîç System Diagnostics</h1>
        <p class="subtitle">Real-time monitoring of your Security Lab application</p>

        <div class="status-grid" id="statusGrid">
            <div class="status-card">
                <h2>
                    <span class="status-icon">üåê</span>
                    Frontend Server
                    <span class="status-indicator checking" id="frontendStatus"></span>
                </h2>
                <div class="detail"><strong>URL:</strong> <span id="frontendUrl">Checking...</span></div>
                <div class="detail"><strong>Status:</strong> <span id="frontendMsg">Testing connection...</span></div>
            </div>

            <div class="status-card">
                <h2>
                    <span class="status-icon">‚öôÔ∏è</span>
                    Backend API
                    <span class="status-indicator checking" id="backendStatus"></span>
                </h2>
                <div class="detail"><strong>URL:</strong> <span id="backendUrl">Checking...</span></div>
                <div class="detail"><strong>Status:</strong> <span id="backendMsg">Testing connection...</span></div>
            </div>

            <div class="status-card">
                <h2>
                    <span class="status-icon">üíæ</span>
                    Database
                    <span class="status-indicator checking" id="dbStatus"></span>
                </h2>
                <div class="detail"><strong>Users:</strong> <span id="dbUsers">Loading...</span></div>
                <div class="detail"><strong>Status:</strong> <span id="dbMsg">Checking...</span></div>
            </div>

            <div class="status-card">
                <h2>
                    <span class="status-icon">üìú</span>
                    JavaScript
                    <span class="status-indicator checking" id="jsStatus"></span>
                </h2>
                <div class="detail"><strong>Functions:</strong> <span id="jsFunctions">Loading...</span></div>
                <div class="detail"><strong>Status:</strong> <span id="jsMsg">Checking...</span></div>
            </div>
        </div>

        <div class="section">
            <h2>üéØ What's Happening Here?</h2>
            
            <div class="explanation">
                <h3>System Architecture</h3>
                <p>Your Security Lab is a <strong>full-stack web application</strong> with these components:</p>
                <div class="timeline">
                    <div class="timeline-item">
                        <strong>Frontend (Port 8000)</strong> - Serves HTML/CSS/JavaScript files
                        <div class="code-block">http://localhost:8000</div>
                    </div>
                    <div class="timeline-item">
                        <strong>Backend (Port 5000)</strong> - Flask API for user authentication and database operations
                        <div class="code-block">http://127.0.0.1:5000/api</div>
                    </div>
                    <div class="timeline-item">
                        <strong>Database</strong> - SQLite storing users, login attempts, and password history
                        <div class="code-block">backend/instance/auth_security_lab.db</div>
                    </div>
                </div>
            </div>

            <div class="explanation">
                <h3>How It Works</h3>
                <ul class="feature-list">
                    <li><strong>1. User Opens Page</strong> ‚Üí Browser requests HTML from Frontend Server (port 8000)</li>
                    <li><strong>2. Page Loads Assets</strong> ‚Üí CSS and JavaScript files load from /assets/</li>
                    <li><strong>3. JavaScript Runs</strong> ‚Üí api-client.js checks if Backend is available</li>
                    <li><strong>4. Backend Check</strong> ‚Üí Tries to connect to http://127.0.0.1:5000/api/test</li>
                    <li><strong>5a. Backend Online</strong> ‚Üí Uses Flask API for all operations (database, hashing, auth)</li>
                    <li><strong>5b. Backend Offline</strong> ‚Üí Falls back to LocalStorage (client-side only)</li>
                </ul>
            </div>

            <div class="explanation">
                <h3>Current Issues & Solutions</h3>
                <div id="issuesFound"></div>
            </div>
        </div>

        <div class="section">
            <h2>üöÄ Available Features</h2>
            <ul class="feature-list">
                <li>‚úÖ <strong>Login System</strong> - User authentication with MD5/SHA-1/BCrypt/Argon2</li>
                <li>‚úÖ <strong>Registration</strong> - Create accounts with different hash algorithms</li>
                <li>‚úÖ <strong>Dashboard</strong> - View all users, their algorithms, and security status</li>
                <li>‚úÖ <strong>Breach Time Calculator</strong> - Estimate password cracking time</li>
                <li>‚úÖ <strong>Hash Tools</strong> - Generate and verify hashes</li>
                <li>‚úÖ <strong>Security Testing</strong> - Test SQL injection, XSS, CSRF vulnerabilities</li>
                <li>‚úÖ <strong>Security Guide</strong> - Learn best practices</li>
                <li>‚úÖ <strong>Database Export</strong> - Export hashes for Hashcat testing</li>
            </ul>
        </div>

        <div class="section">
            <h2>üéÆ Quick Actions</h2>
            <div class="action-buttons">
                <button onclick="window.open('http://localhost:8000/index.html', '_blank')">
                    üè† Open Login Page
                </button>
                <button onclick="window.open('http://localhost:8000/pages/register.html', '_blank')">
                    üë§ Open Registration
                </button>
                <button onclick="window.open('http://localhost:8000/pages/dashboard.html', '_blank')">
                    üìä Open Dashboard
                </button>
                <button onclick="window.open('http://localhost:8000/pages/all-features.html', '_blank')">
                    üéØ View All Features
                </button>
                <button onclick="location.reload()">
                    üîÑ Refresh Status
                </button>
            </div>
        </div>
    </div>

    <script>
        async function checkFrontend() {
            try {
                const response = await fetch('http://localhost:8000/index.html', { method: 'HEAD' });
                if (response.ok) {
                    document.getElementById('frontendStatus').className = 'status-indicator online';
                    document.getElementById('frontendUrl').textContent = 'http://localhost:8000';
                    document.getElementById('frontendMsg').innerHTML = '<span class="success">‚úì Server is running</span>';
                    return true;
                }
            } catch (error) {
                document.getElementById('frontendStatus').className = 'status-indicator offline';
                document.getElementById('frontendUrl').textContent = 'http://localhost:8000 (NOT RUNNING)';
                document.getElementById('frontendMsg').innerHTML = '<span class="error">‚úó Server not responding</span>';
                return false;
            }
        }

        async function checkBackend() {
            try {
                const response = await fetch('http://127.0.0.1:5000/api/test');
                const data = await response.json();
                document.getElementById('backendStatus').className = 'status-indicator online';
                document.getElementById('backendUrl').textContent = 'http://127.0.0.1:5000';
                document.getElementById('backendMsg').innerHTML = '<span class="success">‚úì API responding: ' + data.message + '</span>';
                return true;
            } catch (error) {
                document.getElementById('backendStatus').className = 'status-indicator offline';
                document.getElementById('backendUrl').textContent = 'http://127.0.0.1:5000 (NOT RUNNING)';
                document.getElementById('backendMsg').innerHTML = '<span class="error">‚úó API not responding - Using LocalStorage fallback</span>';
                return false;
            }
        }

        async function checkDatabase() {
            try {
                const response = await fetch('http://127.0.0.1:5000/api/users');
                const data = await response.json();
                const users = data.users || [];
                document.getElementById('dbStatus').className = 'status-indicator online';
                document.getElementById('dbUsers').textContent = users.length + ' registered';
                document.getElementById('dbMsg').innerHTML = '<span class="success">‚úì Database connected</span>';
                return { online: true, count: users.length };
            } catch (error) {
                document.getElementById('dbStatus').className = 'status-indicator offline';
                document.getElementById('dbUsers').textContent = 'Using LocalStorage';
                document.getElementById('dbMsg').innerHTML = '<span class="warning">‚ö† Using client-side storage</span>';
                
                // Check localStorage
                const localUsers = JSON.parse(localStorage.getItem('authSecurityLab_users') || '[]');
                document.getElementById('dbUsers').textContent = localUsers.length + ' in LocalStorage';
                return { online: false, count: localUsers.length };
            }
        }

        function checkJavaScript() {
            const functions = ['getAllUsers', 'loginUser', 'registerUser', 'loadDashboard'];
            const available = functions.filter(fn => typeof window[fn] === 'function');
            
            if (available.length === functions.length) {
                document.getElementById('jsStatus').className = 'status-indicator online';
                document.getElementById('jsFunctions').textContent = available.length + '/' + functions.length + ' loaded';
                document.getElementById('jsMsg').innerHTML = '<span class="success">‚úì All core functions available</span>';
                return true;
            } else {
                document.getElementById('jsStatus').className = 'status-indicator offline';
                document.getElementById('jsFunctions').textContent = available.length + '/' + functions.length + ' loaded';
                document.getElementById('jsMsg').innerHTML = '<span class="error">‚úó Some functions missing</span>';
                return false;
            }
        }

        async function diagnoseIssues() {
            const frontend = await checkFrontend();
            const backend = await checkBackend();
            const db = await checkDatabase();
            
            // Load scripts for function check
            await loadScripts();
            const js = checkJavaScript();

            const issuesDiv = document.getElementById('issuesFound');
            let issues = [];

            if (!frontend) {
                issues.push(`
                    <div class="code-block error">
                        <strong>‚ùå Frontend Server Not Running</strong><br>
                        <strong>Problem:</strong> Cannot access http://localhost:8000<br>
                        <strong>Solution:</strong> Run this command:<br>
                        <code>cd d:\\Computer-Security && python -m http.server 8000</code>
                    </div>
                `);
            }

            if (!backend) {
                issues.push(`
                    <div class="code-block warning">
                        <strong>‚ö†Ô∏è Backend API Not Running</strong><br>
                        <strong>Problem:</strong> Flask server not responding on port 5000<br>
                        <strong>Solution:</strong> Run this command:<br>
                        <code>cd d:\\Computer-Security\\backend && python app.py</code><br>
                        <strong>Note:</strong> App will work with LocalStorage fallback
                    </div>
                `);
            }

            if (issues.length === 0) {
                issuesDiv.innerHTML = `
                    <div class="code-block success">
                        <strong>‚úÖ No Issues Found!</strong><br>
                        All systems are operational. Your application is ready to use.<br><br>
                        <strong>Next Steps:</strong><br>
                        1. Click "Open Login Page" above<br>
                        2. Register a new user<br>
                        3. Test different hash algorithms (MD5, SHA-1, BCrypt, Argon2)<br>
                        4. View users in the Dashboard<br>
                        5. Try the Breach Time Calculator
                    </div>
                `;
            } else {
                issuesDiv.innerHTML = issues.join('');
            }
        }

        async function loadScripts() {
            return new Promise((resolve) => {
                if (typeof window.getAllUsers === 'function') {
                    resolve();
                    return;
                }
                
                const script1 = document.createElement('script');
                script1.src = '/assets/js/api-client.js';
                script1.onload = () => {
                    const script2 = document.createElement('script');
                    script2.src = '/assets/js/script.js';
                    script2.onload = () => setTimeout(resolve, 500);
                    script2.onerror = resolve;
                    document.head.appendChild(script2);
                };
                script1.onerror = resolve;
                document.head.appendChild(script1);
            });
        }

        // Run diagnostics on load
        window.addEventListener('load', () => {
            setTimeout(diagnoseIssues, 500);
        });
    </script>
</body>
</html>
